// =====================================================
// نموذج طلب القطع - Request Model
// هذا الملف يحتوي على مخطط قاعدة البيانات لطلبات الزبائن
// =====================================================

// استيراد مكتبة mongoose للتعامل مع MongoDB
const mongoose = require('mongoose');

// =====================================================
// تعريف مخطط الطلب - Request Schema Definition
// =====================================================
const requestSchema = new mongoose.Schema({

    // اسم الزبون الذي قدم الطلب
    customerName: {
        type: String, // نوع البيانات: نص
        required: [true, 'اسم الزبون مطلوب'], // حقل إجباري
        trim: true // إزالة المسافات الزائدة
    },

    // رقم هاتف الزبون للتواصل عبر WhatsApp
    customerPhone: {
        type: String, // نوع البيانات: نص
        required: [true, 'رقم الهاتف مطلوب'], // حقل إجباري
        trim: true // إزالة المسافات الزائدة
    },

    // معرف الزبون في النظام (اختياري)
    customerId: {
        type: mongoose.Schema.Types.ObjectId, // نوع البيانات: معرف MongoDB
        ref: 'User' // مرجع لنموذج المستخدم
    },

    // اسم القطعة المطلوبة
    partName: {
        type: String, // نوع البيانات: نص
        required: [true, 'اسم القطعة المطلوبة مطلوب'], // حقل إجباري
        trim: true // إزالة المسافات الزائدة
    },

    // ماركة السيارة
    carMake: {
        type: String, // نوع البيانات: نص
        required: [true, 'ماركة السيارة مطلوبة'], // حقل إجباري
        trim: true // إزالة المسافات الزائدة
    },

    // موديل السيارة
    carModel: {
        type: String, // نوع البيانات: نص
        required: [true, 'موديل السيارة مطلوب'], // حقل إجباري
        trim: true // إزالة المسافات الزائدة
    },

    // سنة صنع السيارة
    carYear: {
        type: String, // نوع البيانات: نص
        trim: true // إزالة المسافات الزائدة
    },

    // ملاحظات إضافية من الزبون
    notes: {
        type: String, // نوع البيانات: نص
        trim: true, // إزالة المسافات الزائدة
        maxlength: [500, 'الملاحظات يجب ألا تتجاوز 500 حرف'] // الحد الأقصى للطول
    },

    // حالة الطلب
    status: {
        type: String, // نوع البيانات: نص
        enum: ['جديد', 'قيد المعالجة', 'تم الرد', 'مكتمل', 'ملغي'], // القيم المسموح بها
        default: 'جديد' // القيمة الافتراضية
    },

    // تاريخ إنشاء الطلب
    createdAt: {
        type: Date, // نوع البيانات: تاريخ
        default: Date.now // القيمة الافتراضية هي الوقت الحالي
    }
});

// =====================================================
// إنشاء وتصدير النموذج
// =====================================================
const Request = mongoose.model('Request', requestSchema);

// تصدير النموذج للاستخدام في ملفات أخرى
module.exports = Request;
