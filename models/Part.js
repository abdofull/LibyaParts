// =====================================================
// نموذج القطعة - Part Model
// هذا الملف يحتوي على مخطط قاعدة البيانات لقطع الغيار
// =====================================================

// استيراد مكتبة mongoose للتعامل مع MongoDB
const mongoose = require('mongoose');

// =====================================================
// تعريف مخطط القطعة - Part Schema Definition
// =====================================================
const partSchema = new mongoose.Schema({

    // اسم القطعة
    name: {
        type: String, // نوع البيانات: نص
        required: [true, 'اسم القطعة مطلوب'], // حقل إجباري
        trim: true, // إزالة المسافات الزائدة
        maxlength: [100, 'اسم القطعة يجب ألا يتجاوز 100 حرف'] // الحد الأقصى للطول
    },

    // وصف القطعة
    description: {
        type: String, // نوع البيانات: نص
        trim: true, // إزالة المسافات الزائدة
        maxlength: [500, 'الوصف يجب ألا يتجاوز 500 حرف'] // الحد الأقصى للطول
    },

    // تصنيف القطعة (محرك، فرامل، كهرباء، إلخ)
    category: {
        type: String, // نوع البيانات: نص
        required: [true, 'تصنيف القطعة مطلوب'], // حقل إجباري
        enum: [ // القيم المسموح بها
            'محرك',
            'فرامل',
            'كهرباء',
            'تعليق',
            'جير',
            'هيكل',
            'إكسسوارات',
            'زيوت وفلاتر',
            'إطارات',
            'أخرى'
        ]
    },

    // سعر القطعة بالدينار الليبي
    price: {
        type: Number, // نوع البيانات: رقم
        required: [true, 'سعر القطعة مطلوب'], // حقل إجباري
        min: [0, 'السعر لا يمكن أن يكون سالباً'] // الحد الأدنى للسعر
    },

    // صورة القطعة بصيغة Base64
    // نستخدم Base64 لتخزين الصورة مباشرة في قاعدة البيانات
    // هذا يضمن بقاء الصور بعد النشر على أي منصة
    imageUrl: {
        type: String, // نوع البيانات: نص (سلسلة Base64)
        default: '' // القيمة الافتراضية: فارغ
    },

    // ماركة السيارة التي تناسبها القطعة
    carMake: {
        type: String, // نوع البيانات: نص
        required: [true, 'ماركة السيارة مطلوبة'], // حقل إجباري
        trim: true // إزالة المسافات الزائدة
    },

    // موديل السيارة
    carModel: {
        type: String, // نوع البيانات: نص
        required: [true, 'موديل السيارة مطلوب'], // حقل إجباري
        trim: true // إزالة المسافات الزائدة
    },

    // سنة صنع السيارة
    carYear: {
        type: String, // نوع البيانات: نص
        trim: true // إزالة المسافات الزائدة
    },

    // معرف التاجر صاحب القطعة
    // يرتبط بنموذج المستخدم
    merchantId: {
        type: mongoose.Schema.Types.ObjectId, // نوع البيانات: معرف MongoDB
        ref: 'User', // مرجع لنموذج المستخدم
        required: [true, 'معرف التاجر مطلوب'] // حقل إجباري
    },

    // اسم التاجر للعرض السريع
    merchantName: {
        type: String, // نوع البيانات: نص
        trim: true // إزالة المسافات الزائدة
    },

    // رقم هاتف التاجر للتواصل
    merchantPhone: {
        type: String, // نوع البيانات: نص
        trim: true // إزالة المسافات الزائدة
    },

    // هل القطعة مميزة؟ (تظهر بتصميم خاص)
    isFeatured: {
        type: Boolean, // نوع البيانات: منطقي
        default: false // القيمة الافتراضية: غير مميزة
    },

    // حالة القطعة (متوفرة أو غير متوفرة)
    status: {
        type: String, // نوع البيانات: نص
        enum: ['متوفرة', 'غير متوفرة'], // القيم المسموح بها
        default: 'متوفرة' // القيمة الافتراضية
    },

    // تاريخ إضافة القطعة
    createdAt: {
        type: Date, // نوع البيانات: تاريخ
        default: Date.now // القيمة الافتراضية هي الوقت الحالي
    }
});

// =====================================================
// إنشاء فهرس للبحث السريع
// يساعد في تسريع عمليات البحث
// =====================================================
partSchema.index({ name: 'text', carMake: 'text', carModel: 'text' });

// =====================================================
// إنشاء وتصدير النموذج
// =====================================================
const Part = mongoose.model('Part', partSchema);

// تصدير النموذج للاستخدام في ملفات أخرى
module.exports = Part;
